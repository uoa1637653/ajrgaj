\documentclass[12pt,a5paper]{article}
\usepackage[a5paper,margin=6mm]{geometry}
%\usepackage{graphicx}
\usepackage{amsmath,amsfonts,defns}
\usepackage{pgfplots}

\newcommand{\Bb}[1]{%
  \expandafter\def\csname#1#1\endcsname%
  {\ensuremath{\mathbb #1}}}
\Bb X\Bb T\Bb R\Bb I\Bb J

\usepackage{pdfcomment}
\newcommand{\ajr}[1]{%
  \pdfcomment[author=AJR,color={1 1 0},subject={#1}]{#1}}
\newcommand{\gaj}[1]{%
  \pdfcomment[author=GAJ,color={0 1 1},subject={#1}]{#1}}
\AtBeginDocument{\listofpdfcomments}

\title{Notes on the Diffusion Equation}

\begin{document}
\maketitle
\section{Introduction}
Consider an arbitrary solution $u:\XX\times \TT\mapsto \RR$ to the simple diffusion equation 
\begin{eqnarray}
	\D tu = \DD xu\,.
	\label{eq:diff}
\end{eqnarray}
A computationally feasible approach would be to 
first establish $|{\JJ}|$ discrete grid-points,
${\vec X}=[X_j]_{j\in\JJ}$, and thence
partition the spatial domain \XX\ into 
contiguous intervals \(\II_j:=(X_{j-1},X_j]\). 
The coarse dynamics at the grid-points are then summarised by
${\vec U}=[U_j]_{j\in\JJ}$, where $U_j(t)=u(X_j,t)$ for all $t\in \TT$, according to some temporal evolution
\begin{eqnarray}
	\dot{\vec U}(t) = {\vec g}({\vec U}(t))\,.
	\label{eq:temporal}
\end{eqnarray}
Consequently, a link from the coarse dynamics ${\vec U}$ back to the continuum dynamics $u$ might be provided
by choosing an appropriate spatial mapping of the form
\begin{eqnarray}
	u  := u(x,{\vec U}(t)).
	\label{eq:spatial}
\end{eqnarray}
Under this scheme, the linear diffusion equation~(\ref{eq:diff}) becomes
\begin{eqnarray}
	\D {\vec U}{u}\cdot{\vec g} = \DD x{u}\,.
	\label{eq:diff2}
\end{eqnarray}
Observe that the evolution of $u$ now has nonlinear interactions with ${\vec U}$.

\section{Centre Manifold Approximation}
The original diffusion equation~(\ref{eq:diff}) admits 
eigensolutions of the form
\begin{eqnarray}
	u(x,t)  = e^{\lambda t\pm\sqrt{\lambda}x}\,,
\label{eq:raw-eigmode}
\end{eqnarray}
which are physically realisable for real eigenvalues $\lambda=-k^2\le 0$ for 
corresponding eigenmode wavenumbers $\pm k$. 
As a consequence, the transient solutions corresponding
to $\lambda<0$ decay rapidly to the centre manifold corresponding to $\lambda=0$. 

This centre manifold can be found in practice by iteratively refining approximations to $u$. In particular, consider a series expansion of the form
\begin{eqnarray}
	u  & \sim & \hat{u}_0+\gamma\hat{u}_1+\gamma^2\hat{u}_2+\cdots\,,
\label{eq:u:series}
\end{eqnarray}
for some parameter $0\le\gamma\le 1$.
Now, the constant eigensolution for $\lambda=0$ implies a slow evolution for the coarse dynamics given by 
equation~(\ref{eq:temporal}), which therefore admits a series expansion of the form
\begin{eqnarray}
	\dot{{\vec U}} & \sim & \gamma {\vec g}_1+\gamma^2 {\vec g}_2+\cdots\,.
\end{eqnarray}
Hence, equation~(\ref{eq:diff2}) may be decomposed at each order 
$\ell$ of the parameter $\gamma$, giving
\begin{eqnarray}
   \DD {x}{\hat{u}_0} & = & 0\,, \label{eq:pert1}
\\
  \DD {x}{\hat{u}_\ell} & = & \sum_{m=0}^{\ell-1}\D {\vec U}{\hat{u}_m}\cdot{\vec g}_{\ell-m}\,,
\hspace*{5mm}\mbox{for }\ell=1,2,\ldots\,.
\label{eq:pert_ell}
\end{eqnarray}


\section{Leading Approximation}
The leading equation~(\ref{eq:pert1}) admits any spatially piecewise linear function as a solution. 
Hence, in keeping
with the discretisation imposed by the coarse dynamics, 
consider the linear approximation
\begin{eqnarray}
   \hat{u}_0 = \sum_{j\in\JJ}\chi_j(\xi_j U_j+(1-\xi_j)U_{j-1})\,,
\label{eq:uhat0}
\end{eqnarray}
with indicator $\chi_j(x)=1$ (or 0) for $x\in\II_j$ (or $x\not\in\II_j$), and interpolator
$\xi_j(x)=\frac{x-X_{j-1}}{X_j-X_{j-1}}$.
This particular approximation is chosen to be continuous across the boundaries of each interval $\II_j$. 
In general, it suffices 
to impose a continuity condition at the right-hand end of each $\II_j$, namely:
\begin{eqnarray}
   [u]_j := \lim_{\epsilon\rightarrow 0^{+}} u(X_j+\epsilon,t)-u(X_j-\epsilon,t)= 0\,.
\label{eq:cont-cond}
\end{eqnarray}
Unfortunately, this linear approximation is not smooth at the interval boundaries. 
For convenience, consider regular grid spacings of size 
$X_j-X_{j-1}=H$. Then, denoting $\D xu$ as $u'$, observe that
\begin{eqnarray}
   [\hat{u}'_1]_j = \frac{1}{H}(U_{j+1}+U_{j-1}-2U_j)~=~\frac{1}{H}\left.\delta^{2}\hat{u}_0\right|_{X_j}\,,
\end{eqnarray}
for the centred difference $\delta u(x,t):= u(x+\frac{H}{2},t)-u(x-\frac{H}{2},t)$\,.
However, this non-smoothness may be corrected at higher order by imposing a further internal boundary condition, namely
\begin{eqnarray}
   [u']_j = \frac{1-\gamma}{H}\left.\delta^{2}u\right|_{X_j}\,.
\label{eq:smooth-cond}
\end{eqnarray}
Consequently, smooth approximations are found in the limit as $\gamma\rightarrow 1$.

\section{Linear Eigenmode Analysis}
Consider a single eigenmode of the form~(\ref{eq:raw-eigmode}) for some fixed, non-dimensionalised 
wavenumber $\kappa=kH>0$. 
Thus, allowing for the partitioning of \XX, let
\begin{eqnarray}
u & \sim & \sum_{j\in\JJ} \chi_j a_j e^{i\kappa\xi_j} + \text{c.c.}\,,
\end{eqnarray}
for arbitrary, time--varying, complex coefficients $a_j=A_j+iB_j$. 
We now seek the `spatial' evolution from interval to interval for the given wavenumber.
The continuity condition~(\ref{eq:cont-cond}) implies that
\begin{eqnarray}
a_{j+1} - a_j e^{i\kappa\xi_j} + \text{c.c.} = 0\,.
\end{eqnarray}
Similarly, the smoothness condition~(\ref{eq:smooth-cond}) implies that 
\begin{eqnarray}
ik a_{j+1} -ik a_j e^{i\kappa} + \text{c.c.} =  
\frac{1-\gamma}{H}\left(
a_{j+1} e^{i\kappa} + a_j - 2 a_j e^{i\kappa}
\right)
+ \text{c.c.}\,,
\end{eqnarray}
where continuity has also been invoked at the left-hand of the $j$th interval.
In coefficient form, the update from the $j$th to $(j+1)$th segment is
\begin{eqnarray}
\left[\begin{array}{cc}
1 & 0\\
fc & 1-fs\\
\end{array}\right]
\left[\begin{array}{c}
A_{j+1}\\
B_{j+1}\\
\end{array}\right]
=
\left[\begin{array}{cc}
c & -s\\
s+f(2c-1) & c-2fs\\
\end{array}\right]
\left[\begin{array}{c}
A_{j}\\
B_{j}\\
\end{array}\right]\,,
\end{eqnarray}
where $c+is:=e^{i\kappa}$ and $f:=\frac{1-\gamma}{\kappa}$.
Now, letting $a_{j+1}=\mu a_j$, the characteristic equation for 
the growth factor $\mu$ is
\begin{eqnarray}
(1-fs)\left[\mu^2-2\frac{c-fs}{1-fs}\mu+1\right] = 0\,,
\end{eqnarray}
with roots given by
\begin{eqnarray}
\mu & = & \beta\pm\sqrt{\beta^2-1}
\hspace*{5mm}\mbox{for } 
\beta~=~\frac{c-fs}{1-fs}\,.
\end{eqnarray}
Observe that $\beta\le 1$ since $c=\cos\kappa\le 1$ and 
$1-fs=1-(1-\gamma)\frac{\sin\kappa}{\kappa}\ge 0$.
Thus, for $|\beta|<1$, the factors are complex with magnitude 
$|\mu|=1$,
indicating marginally stable evolution of $a_j$. 
This includes the limiting case of $\gamma=1$ ($f=0$), for which
$\mu=c\pm is=e^{\pm i\kappa}$.
Likewise, $\mu=\pm 1$ for $\beta=\pm 1$, corresponding to $\kappa=n\pi$, $n=0,1,2,\ldots$.
Finally, for small regions near each $\kappa=(2n+1)\pi$, 
it is found that $\beta<-1$, resulting in two real factors,
$\mu<-1$ and $-1<\mu<0$, indicating unstable (saddle) evolution.
More precisely, these unstable regions occur when
\begin{eqnarray}
%c-fs < -(1-fs) & \Rightarrow & 1+c < 2fs 
%\frac{kH}{1-\gamma}\cos^2\frac{kH}{2} < 2\sin\frac{kH}{2}\cos\frac{kH}{2}\,.
\frac{\kappa}{2} <(1-\gamma)\tan\frac{\kappa}{2}\,, && \kappa\ne n\pi\,.
\label{eq:leaforbid}
\end{eqnarray}
Thus, at equilibrium ($\gamma=0$) there is an initial forbidden gap $\kappa\in(0,\pi)$ adjacent to the centre manifold
wavenumber $\kappa=0$ (see Figure~\ref{fig:leaspec}), indicating that transient solutions decay to the centre manifold at a rate of at least
$\lambda=-\frac{\kappa^2}{H^2}=-\frac{\pi^2}{H^2}$. It is this gap that provides robustness to nonlinear perturbations
of the system about the equilibrium.

\begin{figure}
\centering
\begin{tikzpicture}
\begin{axis}[ xlabel={$\kappa$}
  ,axis x line=middle,axis y line=middle
  ,thick,grid,samples=101
  ,ymin=-1,ymax=8 ,domain=0:17
  ,xtick={3.1416,6.2832,9.4248,12.5664,15.7080}
  ,xticklabels={$\pi$,$2\pi$,$3\pi$,$4\pi$,$5\pi$}
  ,legend pos=outer north east
  ] 
\addplot [blue,no marks] {tan(deg(x)/2)}; 
\addlegendentry{$\tan(\kappa/2)$};
\addplot [red,no marks,samples=2] {x/2}; 
\addlegendentry{$\kappa/2$};
\addplot [brown,only marks,mark=*] {0-99*(x/2<tan(deg(x)/2))};
\addlegendentry{spectrum};
\end{axis}
\end{tikzpicture}
\caption{The equilibrium spectrum determined by the forbidding condition~\eqref{eq:leaforbid}.}
\label{fig:leaspec}
\end{figure}


\section{Linear Dual Space}
Assuming a spatially square-integrable field over \XX, an appropriate inner product for a solution $u$ and its dual $v$ can be shown to obey
\begin{eqnarray}
\langle u'',v\rangle =
\langle u,v''\rangle + R\,,
\end{eqnarray}
with residual 
\begin{eqnarray}
R &= & \sum_{j\in\JJ}\left[u'v-v'u\right]_{X_{j-1}}^{X_j}\,.
\end{eqnarray}
Now, letting $r=u'v-v'u$, the residual becomes 
\begin{eqnarray}
R = r_{\bar{J}}-r_{\underline{J}}-\sum_{j=\underline{J}+1}^{\bar{J}-1}[r]_j\,,
\end{eqnarray}
for outer boundary indices $\underline{J}=\inf{\JJ}$ and $\bar{J}=\sup{\JJ}$
(supposing $|\JJ|> 2$).
Assuming that $v$ also obeys conditions~(\ref{eq:cont-cond}) and~(\ref{eq:smooth-cond}), 
the residual jump at $X_j$ becomes
\begin{eqnarray}
[r]_j & = & [u']_j V_j-[v']_j U_j
\nonumber\\
& = & \frac{1-\gamma}{H}\left[
(U_{j+1}+U_{j-1})V_j-(V_{j+1}+V_{j-1})U_j
\right]\,.
\end{eqnarray}
Observe that terms from adjacent intervals $\II_{j-1}$ and $\II_{j+1}$ will cancel terms from $\II_j$, leaving
only contributions from the outermost boundary intervals $\II_{\underline{J}+1}$ and $\II_{\bar{J}}$; consequently:
\begin{eqnarray}
R & = & 
u'_{\bar{J}}V_{\bar{J}}-v'_{\bar{J}}U_{\bar{J}}
-u'_{\underline{J}}V_{\underline{J}}+v'_{\underline{J}}U_{\underline{J}}
\nonumber\\ &&
{}-\frac{1-\gamma}{H}\left[
U_{\bar{J}}V_{\bar{J}-1}-V_{\bar{J}}U_{\bar{J}-1}
+U_{\underline{J}}V_{\underline{J}+1}-V_{\underline{J}}U_{\underline{J}+1}
\right]\,.
\end{eqnarray}
On a finite domain , there are three main outer boundary conditions that lead to a zero residual:
\begin{description}
\item[periodic] TODO;
\item[Dirichlet] Setting \(u=0\) at $X_{\underline{J}}$ and $X_{\bar{J}}$ corresponds to \(U_{\underline{J}}=U_{\bar{J}}=0\), 
giving $R=0$ if correspondingly \(v=0\) on the boundaries.
\item[Neumann] Requiring \(u'=0\) on the boundaries  (for $\gamma=1$) corresponds to 
\(u'_{\underline{J}}=\frac{1-\gamma}{H}(U_{\underline{J}+1}-U_{\underline{J}})\)
and \(u'_{\bar{J}}=\frac{1-\gamma}{H}(U_{\bar{J}}-U_{\bar{J}-1})\),
giving $R=0$ if correspondingly \(v'=0\) on the boundaries.
\end{description}
Under any of the above three conditions, observe that $\langle{\cal L}u,v\rangle =\langle u,{\cal L}v\rangle$
for ${\cal L}=\DD {x}{}$, and hence ${\cal L}$ is self-adjoint.
Furthermore, we are free to choose any dual $v$ to satisfy ${\cal L}v=0$ for conenience.
In particular, we may specifically target the $j$-th interval for $u$, for each $j\in\JJ$,  with $v=\hat{v}_0^{[j]}$, where
\begin{eqnarray}
\hat{v}_0^{[j]} = \chi_j\xi_j + \chi_{j+1}(1-\xi_{j+1})\,,
\end{eqnarray}
which satisfies conditions~\eqref{eq:cont-cond} and~\eqref{eq:smooth-cond} for $\gamma=0$.


\section{First-order Approximation}
Substituting the leading approximation~(\ref{eq:uhat0}) into the
nonlinear diffusion equation~(\ref{eq:pert_ell}) for $\ell=1$ results in
the first-order equation
\begin{eqnarray}
\hat{u}''_1 = \sum_{j\in\JJ}\chi_j(\xi_j g_{1,j}+(1-\xi_j)g_{1,j-1})\,.
\end{eqnarray}
Spatial integration then gives
\begin{eqnarray}
\hat{u}'_1 & = & \frac{H}{2}\sum_{j\in\JJ}\chi_j(\xi^2_j g_{1,j}
-(1-\xi_j)^2g_{1,j-1}+c_{1,j})\,,
\label{eq:udhat1}
\\
\hat{u}_1 & = & \frac{H^2}{6}\sum_{j\in\JJ}\chi_j(\xi^3_j g_{1,j}
+(1-\xi_j)^3g_{1,j-1}+3\xi_{j}c_{1,j}+d_{1,j})\,.
\label{eq:uhat1}
\end{eqnarray}
Recall from the chosen  spatial discretisation that $u|_{X_j}=U_{j}$ at each grid-point.
Observe this is already satified by $\hat{u}_0$ from equation~(\ref{eq:uhat0}), implying
from expansion~(\ref{eq:u:series}) that
\begin{eqnarray}
\left.\hat{u}_\ell\right|_{X_j}=0 && \mbox{for }\ell=1,2,\ldots\,.
\end{eqnarray}
Thus $[\hat{u}_\ell]_j=0$, satisfying the continuity 
condition~(\ref{eq:cont-cond}), and $\delta^2\hat{u}_\ell|_{X_j}=0$.
Now, evaluating equation~(\ref{eq:uhat1}) at $\xi_j=0$ gives $d_{1,j}=-g_{1,j-1}$,
and at $\xi_j=1$ gives $3c_{1,j}=-(g_{1,j}-g_{1,j-1})$.
Thus,  from equation~(\ref{eq:udhat1}), observe that
\begin{eqnarray}
[\hat{u}'_1]_j = -H(1+\frac{1}{6}\delta^2)g_{1,j}\,.
\end{eqnarray}
However, the smoothness condition~(\ref{eq:smooth-cond}) gives
\begin{eqnarray}
   [\hat{u}'_1]_j = 
\frac{1}{H}\left.\delta^{2}\hat{u}_1\right|_{X_j}
-\frac{1}{H}\left.\delta^{2}\hat{u}_0\right|_{X_j}
= -\frac{1}{H}\delta^{2}U_j\,,
\end{eqnarray}
and hence
\begin{eqnarray}
\left(1+\frac{1}{6}\delta^2\right)g_{1,j} = \frac{1}{H^2}\delta^2U_j\,.
\end{eqnarray}
This solution can also be otained more directly by solving the dual equation $\langle{\cal L}\hat{u}_1,\hat{v}_0^{[j]}\rangle = 0$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}
